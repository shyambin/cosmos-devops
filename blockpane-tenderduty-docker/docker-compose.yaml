version: '3.2'

services:
  node1:
    image: asguardnetwork/spacefolders:assetmantle-v0.3.1
    container_name: node1
    environment:
      - CHAIN_ID=load-test-1
    networks:
      - cosmos
    ports:
      - 26657
    volumes:
      - node1:/root/node1/.mantleNode
    entrypoint: sh
    command:
      - -cex
      - |
        if [[ -f /root/node1/.mantleNode/config/genesis.json ]];
        then
          mantleNode --home /root/node1/.mantleNode start \
          --rpc.laddr=tcp://0.0.0.0:26657 &
          sleep 99999
        else
          mantleNode --home /root/node1/.mantleNode init test --chain-id $$CHAIN_ID
          mantleNode --home /root/node1/.mantleNode keys add test --keyring-backend test
          mantleNode --home /root/node1/.mantleNode add-genesis-account test 10000000000000000000000stake --keyring-backend test
          mantleNode --home /root/node1/.mantleNode gentx test 1000000000stake --keyring-backend test --chain-id $$CHAIN_ID
          mantleNode --home /root/node1/.mantleNode collect-gentxs
        fi
        mantleNode --home /root/node1/.mantleNode start \
        --rpc.laddr=tcp://0.0.0.0:26657 &
        # putting sleep for debugging purpose
        sleep 99999

  tenderduty:
    image: ghcr.io/blockpane/tenderduty:v2.2.1
    container_name: tenderduty
    command: ""
    networks:
      - cosmos
    ports:
      - "8888:8888" # Dashboard
      - "28686:28686" # Prometheus exporter
    volumes:
      - tenderduty_home:/var/lib/tenderduty
      - ./blockpane-tenderduty-config.yaml:/var/lib/tenderduty/config.yml
    logging:
      driver: "json-file"
      options:
        max-size: "20m"
        max-file: "10"
    restart: unless-stopped

volumes:
  node1:
  tenderduty_home:

networks:
  cosmos:
